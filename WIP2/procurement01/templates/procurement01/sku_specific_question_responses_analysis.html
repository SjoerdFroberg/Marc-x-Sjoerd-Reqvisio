{% extends 'procurement01/layout.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}SKU-Specific Question Responses Analysis{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="section-header">
        <h2>SKU-Specific Question Responses Analysis</h2>
    </div>

    <!-- Display RFP details -->
    <div class="mb-3">
        <strong>RFP Title:</strong> {{ rfp.title }}<br>
        <strong>RFP Description:</strong> {{ rfp.description }}
    </div>

    
    <div id="dropdown-container">
        <!-- Form to select questions -->
        <form method="get" id="question-filter-form" class="mb-3">
            <label for="question-select" class="form-label">Select Questions:</label>
            <select id="question-select" name="question_ids[]" multiple="multiple">
                {% if sku_specific_questions %}
                    {% for question in sku_specific_questions %}
                        <option value="{{ question.id }}"
                            {% if question.id|stringformat:"s" in selected_question_ids %}selected{% endif %}>
                            {{ question.question }}
                        </option>
                    {% endfor %}
                {% else %}
                    <option disabled>No choices to choose from</option>
                {% endif %}
            </select>
        </form>

    
        <div>
        <!-- Full-Screen Toggle Button -->
        <button id="toggle-fullscreen-btn" class="btn btn-primary">Full Screen</button>
        
        </div>

        <div id="analysis-fullscreen" class="table-wrapper">

            <button id="exit-fullscreen-btn" class="btn btn-secondary d-none">Exit Full Screen</button>
            <div id = "table-freeze" class="table-freeze">
                <div id="table-container">
                    {% include 'procurement01/sku_specific_question_table.html' %}
                </div>

            </div>
        </div>

    </div>

    


    
{% endblock %}

{% block scripts %}
<!-- Include Choices.js -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script src="{% static 'js/sku_specific_analysis.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    console.log('Choices.js initialization starting...');

    const questionSelect = document.getElementById('question-select');
    console.log('Select element found:', questionSelect);

    if (questionSelect) {
        const choicesData = JSON.parse('{{ sku_specific_questions_json|escapejs }}');
        console.log('Choices data:', choicesData);

        const choices = new Choices(questionSelect, {
            removeItemButton: true,
            searchEnabled: true,
            placeholderValue: 'Select questions to display',
            noResultsText: 'No questions found',
            noChoicesText: '',
            itemSelectText: '',
            shouldSort: false,
            shouldCloseOnSelect: true,
            choices: choicesData
        });

        console.log('Choices.js initialized:', choices);
    } else {
        console.error('Failed to find #question-select for Choices.js.');
    }
});

    
</script>


{% endblock %}
